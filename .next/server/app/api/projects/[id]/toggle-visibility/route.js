"use strict";(()=>{var e={};e.id=319,e.ids=[319],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},2901:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>_,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var o={};t.r(o),t.d(o,{PATCH:()=>u});var i=t(3278),s=t(5002),a=t(4877),n=t(1309),l=t(2557),d=t(3275);async function u(e,{params:r}){try{let t=(0,d.Ym)(e);if(!t)return n.NextResponse.json({error:"Authorization required"},{status:401});let o=(0,l.jq)(),{data:i,error:s}=await o.from("projects").select("*").eq("id",r.id).eq("user_id",t.userId).single();if(s||!i)return n.NextResponse.json({error:"Project not found"},{status:404});let a=!i.is_shown,u=i.display_order;if(a){let{data:e}=await o.from("projects").select("display_order").eq("user_id",t.userId).eq("is_shown",!0).not("display_order","is",null).order("display_order",{ascending:!0}),r=e?.map(e=>e.display_order)||[];for(let e=1;e<=5;e++)if(!r.includes(e)){u=e;break}if(u===i.display_order&&r.length>=5)return n.NextResponse.json({error:"Maximum of 5 projects can be shown at once"},{status:400})}else u=null;let{data:c,error:_}=await o.from("projects").update({is_shown:a,display_order:u,updated_at:new Date().toISOString()}).eq("id",r.id).eq("user_id",t.userId).select().single();if(_)return console.error("Project visibility toggle error:",_),n.NextResponse.json({error:"Failed to toggle project visibility"},{status:500});return!a&&i.display_order&&await p(t.userId,i.display_order),n.NextResponse.json(c)}catch(e){return console.error("Project visibility toggle error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e,r){let t=(0,l.jq)();try{let{data:o}=await t.from("projects").select("id, display_order").eq("user_id",e).eq("is_shown",!0).gt("display_order",r).not("display_order","is",null);if(!o||0===o.length)return;for(let e of o)e.display_order&&await t.from("projects").update({display_order:e.display_order-1,updated_at:new Date().toISOString()}).eq("id",e.id)}catch(e){console.error("Error reordering projects after hiding:",e)}}let c=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/projects/[id]/toggle-visibility/route",pathname:"/api/projects/[id]/toggle-visibility",filename:"route",bundlePath:"app/api/projects/[id]/toggle-visibility/route"},resolvedPagePath:"D:\\Projects\\Portfolio\\sachinthya_portfolio_fullstack\\src\\app\\api\\projects\\[id]\\toggle-visibility\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:_,staticGenerationAsyncStorage:f,serverHooks:y}=c,g="/api/projects/[id]/toggle-visibility/route";function h(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},3275:(e,r,t)=>{t.d(r,{Ym:()=>s});var o=t(7390),i=t.n(o);function s(e){let r=function(e){let r=e.headers.get("authorization");return r&&r.startsWith("Bearer ")?r.substring(7):null}(e);return r?function(e){try{let r=i().verify(e,process.env.JWT_SECRET);return{userId:r.userId,email:r.email}}catch(e){return console.error("Token verification error:",e),null}}(r):null}},2557:(e,r,t)=>{t.d(r,{jq:()=>s});var o=t(6623);t(6574);let i="your_supabase_url_here";function s(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return(0,o.eI)(i,e,{auth:{autoRefreshToken:!1,persistSession:!1}})}(0,o.eI)(i,"your_supabase_anon_key_here")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[787,833,604],()=>t(2901));module.exports=o})();